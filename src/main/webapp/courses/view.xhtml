<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="./../WEB-INF/templates/default.xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:my="http://java.sun.com/jsf/composite/iudex"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
				xmlns:p="http://primefaces.org/ui">
	<f:metadata>
		<f:event type="preRenderView" listener="#{viewCourse.preRenderView()}" />
	</f:metadata>
	<ui:define name="content">
		<div class="container comments-container">
			<c:if test="#{user.loggedIn}">
				<div class="row ">
					<div class="offset5 span7 ">
						<div class="row-fluid">
							<h:form class="well">
								<h:outputText value="CALIFICA EL CURSO" class="span6 fittext-rateInput"/>  
								<div class="span6">
									<p:rating value="#{viewCourse.courseRating}" onRate="showCommentInput()">  
										<p:ajax event="rate" listener="#{viewCourse.handleRate}" update="messages" />  
									</p:rating>  
								</div>
								<p:growl id="messages" showDetail="true"/> 
							</h:form>
						</div>
						<div class="row-fluid hidden" id="commentInput">
							<!-- Beginning of comment -->
							<h:form>
							<div class="row-fluid">
								<div class="comment span12">
									<div class="comment-container span12">
										<div class="comment-rating">
											Calificación del curso : 
											<ui:repeat var="i" value="#{viewCourse.buildArrayCeil(viewCourse.courseRating)}">
												<span class="icon-star"/>
											</ui:repeat>
										</div>
										<div class="comment-photo thumbnail">
											<img src="#{user.imageUrl}" alt="profesor x" />
											<h5>#{user.firstName}</h5>
											<p>CARRERA</p>
										</div>
										<p>
											<h:inputTextarea/>
										</p>
									</div>
								</div>

							</div><!--/row-->
							<!-- Ending of comment -->
							</h:form>
						</div>
					</div>
				</div>
			</c:if>
			<div class="row">
				<div class="offset5 span7">
					<h:form id="voteForm">
						<ui:repeat var="comment" value="#{viewCourse.comments}" varStatus="status">
							<!-- Beginning of comment -->
							<div class="row-fluid">
								<div class="comment span12">
									<div class="comment-container span12">
										<div class="comment-rating">
											Calificación del curso : 
											<ui:repeat var="i" value="#{viewCourse.buildArrayCeil(comment.courseRating)}">
												<span class="icon-star"/>
											</ui:repeat>
										</div>
										<div class="comment-photo thumbnail">
											<img src="#{user.imageUrl}" alt="profesor x" />
											<h5>#{comment.user.name}</h5>
											<p>CARRERA</p>
										</div>
										<p>
											#{comment.content}
										</p>
										<div class="vote">

											<div class="vote-wrapper"><h:commandLink action="#{rating.votePositiveComment(comment)}" class="upvote"><f:ajax event="action" execute="@form" render="voteCount"/></h:commandLink> <f:param name="id" value="#{viewCourse.course.id}" /></div>
											<h:panelGroup id="voteCount" class="vote-wrapper">
												<h:outputText  class="vote-count" value="#{comment.rating.positive-comment.rating.negative}"/>
											</h:panelGroup>
											<div class="vote-wrapper"><h:commandLink action="#{rating.voteNegativeComment(comment)}" class="downvote"><f:ajax event="action" execute="@form" render="voteCount"/>                            <f:param name="id" value="#{viewCourse.course.id}" />
												</h:commandLink></div>

										</div>
									</div>
									<div class="comment-report">
										<span class=""><a href="#">Reportar comentario</a></span>
									</div>

								</div>

							</div><!--/row-->
							<!-- Ending of comment -->
						</ui:repeat>
					</h:form>
				</div><!--/span-->
			</div><!--/row-->



			<!--Professor bar --> 
			<div class="well span4 container-fluid fixed-navbar" >
				<div class="row-fluid">
					<div class="span7 " style="margin-top: 10px; text-align: center; line-height: 200%">
						<h:outputText class="fittext-subject fittext" value="#{viewCourse.course.subject.name}"/>
					</div>
					<div class="span4 container-fluid cuadro-promedio" >
						<div class="row-fluid">
							<h:outputText class="fittext-rating fittext" style="text-align: center;" value="PROMEDIO"/>
						</div>
						<div class="row-fluid" >
							<div class="span6" style="margin-top: 10%;">
								<h:outputText class="fittext-rating fittext" style="text-align: left;" value="#{viewCourse.course.ratingAverage}"/>
							</div>
							<div class="span6">
								<img style="vertical-align: middle;" src="#{request.contextPath}/resources/images/star.png" />
							</div>
						</div>
						<div class="row-fluid">
							<span>
								#{viewCourse.course.ratingCount} personas han votado
							</span>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="professor-photo" >
						<a href=""><img src="#{viewCourse.professor.imageUrl}"/></a>
						<span class="vote-prof">
							<div></div>
						</span>
						<ul class="actions">
							<li class="upvote-prof"><a href="#" class="icon-thumbs-up"></a></li>
							<li class="downvote-prof"><a href="#" class="icon-thumbs-down"></a></li>
						</ul>
						<div>
							<h5><a href="professors/view.html?id=#{viewCourse.course.professor.id}">#{viewCourse.course.professor.fullName}</a></h5>
						</div>
					</div>
				</div>


			</div><!--/.well -->

			<!--End of Professor bar --> 


		</div>
		<!--fitText code-->
		<script type="text/javascript">
			$(".fittext-subject").fitText(0.612423);
			$(".fittext-rating").fitText(0.5);
			$(".fittext-rateInput").fitText(1.1);
			function showCommentInput(){
				//If it was hidden from the begining, it was using the hidden class
				// but before removing the class hide it with jquery.
				$("#commentInput").hide();
				$("#commentInput").removeClass("hidden");
				//Now show it
				$("#commentInput").show("slow");

			}
		</script>
		<!-- End of fitText code-->
	</ui:define>


</ui:composition>
